<div class="dashboard-container">

  <!-- Bandeau accueil -->
  <header class="dashboard-header">
    <h2>Bonjour, {{ user?.name || 'Client' }}</h2>

    <!-- Sélecteur de compte -->
    <section class="account-selector-section" *ngIf="accounts.length > 0">
      <label for="account-select">Compte:</label>
      <select id="account-select" [(ngModel)]="selectedAccount" (change)="onAccountSelect(selectedAccount!)">
        <option *ngFor="let account of accounts" [ngValue]="account">
          {{ getAccountId(account) }} - {{ getAccountLabel(account) }}
        </option>
      </select>
    </section>

    <div class="balance-card">
      <small>Solde disponible</small>
      <h1 [class.positive]="balance >= 0" [class.negative]="balance < 0">
        {{ balance | currency:'EUR':'symbol':'1.2-2' }}
      </h1>
    </div>
  </header>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Actions -->
  <section class="quick-actions">
    <button class="btn-primary" (click)="goToOpenAccount()">
      Ouvrir un compte
    </button>

    <button class="btn-primary" (click)="goToTransfer()">
      Effectuer un virement
    </button>

    <button class="btn-primary" (click)="goToInfo()">
      Info
    </button>

    <button class="btn-secondary" (click)="logout()">
      Déconnexion
    </button>
  </section>

  <!-- Transactions -->
  <section class="transactions-section" *ngIf="selectedAccount">
    <h3>Dernières opérations</h3>

    <!-- État vide -->
    <div class="empty" *ngIf="!transactions || transactions.length === 0">
      Aucune opération à afficher pour le moment.
    </div>

    <div class="transaction-list" *ngIf="transactions && transactions.length > 0">
      <div *ngFor="let tx of transactions" class="transaction-item clickable" (click)="goToTransactionDetail(tx)"
        title="Voir le détail">

        <div class="tx-left">
          <!-- Avatar initiales -->
          <div class="avatar">
            {{ getInitials(tx.emitter.id === selectedAccount?.id ? tx.receiver.owner.name : tx.emitter.owner.name) }}
          </div>

          <div class="tx-info">
            <!-- Nom émetteur/receveur -->
            <div class="tx-name">
              {{ tx.emitter.id === selectedAccount?.id ? 'Pour ' + tx.receiver.owner.name : 'De ' +
              tx.emitter.owner.name }}
            </div>

            <!-- Date format 14/01/2025 14h30 -->
            <div class="tx-date">
              {{ formatDate(tx.createdAt || tx.date || tx.emittedAt || tx.issuedAt) }}
            </div>
          </div>
        </div>

        <!-- Montant : négatif pour virement émis -->
        <div class="tx-amount" [class.credit]="tx.emitter.id !== selectedAccount?.id"
          [class.debit]="tx.emitter.id === selectedAccount?.id" [class.canceled]="tx.status === 'canceled'">

          {{ (tx.emitter.id === selectedAccount?.id ? -tx.amount : tx.amount) | currency:'EUR':'symbol':'1.2-2' }}

          <span *ngIf="tx.status === 'canceled'" class="status-label">
            (Annulée)
          </span>
        </div>
      </div>
    </div>
  </section>

</div>